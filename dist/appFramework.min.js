$.app={};var app={ctx:null,mCtx:null,DB_INSTANCE:null,online:!1,lastControllerName:null,lastModalName:null,langChanged:!1};app.system={createSelectors:function(templateHtml){var selectors={},idList=app.util.System.findStringBetween(templateHtml,'id="','"'),nameList=app.util.System.findStringBetween(templateHtml,'name="','"');return selectors.names={},$.each(nameList,function(i,name){selectors.names[name]=function(){return $('*[name="'+name+'"]')}}),$.each(idList,function(i,id){var newId=id+"-"+app.util.System.hash();selectors[id]=function(eventsToBind){var selector=$("#"+newId);return selector.plainId=newId,$.each(eventsToBind,function(eventName,eventCallback){"click"==eventName?selector.click(eventCallback):"change"==eventName?selector.change(eventCallback):selector.on(eventName,eventCallback)}),selector},templateHtml=templateHtml.replace('id="'+id+'"','id="'+newId+'"')}),{html:templateHtml,selectors:selectors}},waitUntilReady:function(_controller,callBack){return _controller.ready!==!0?void setTimeout(function(){app.system.waitUntilReady(_controller,callBack)},10):void callBack()},waitUntilComponentsReady:function(callBack){return app.component.componentsReady!==app.component.total?void setTimeout(function(){app.system.waitUntilComponentsReady(callBack)},10):void callBack()},renderModal:function(_modal,data){_modal.preventScroll||$(window).scrollTop(0),app.mCtx&&(app.lastModalName=_modal.fullName),app.system.hideModal(),1==_modal.checkNetwork&&app.cordova.checkNetwork(),app.mCtx=$.extend(!0,{},app.modal[_modal.fullName]),void 0==data&&(data=null),app.mCtx.render(data),void 0!==app.events.onRender&&null!==app.events.onRender&&app.events.onRender()},renderLastController:function(){app.system.render(app.controller[app.lastControllerName])},renderLastModal:function(){app.system.renderModal(app.modal[app.lastModalName])},render:function(_controller,data,callBack){$(window).scrollTop(0),null!==app.ctx&&(app.lastControllerName=app.ctx.fullName),app.ctx=$.extend(!0,{},app.controller[_controller.fullName]),app.system.hideModal(),1==_controller.checkNetwork&&app.cordova.checkNetwork(),void 0==data&&(data=null),app.ctx.render(data),void 0!==app.events.onRender&&null!==app.events.onRender&&app.events.onRender(),app.ctx.components instanceof Array?$.each(app.ctx.components,function(i,componentName){app.component[componentName].init(data)}):$.each(app.ctx.components,function(componentName,componentParams){var params=$.app.extendObj(data,componentParams);app.component[componentName].init(params)}),void 0!==callBack&&callBack()},backPrevious:function(){null!==app.lastControllerName&&app.system.render(app.controller[app.lastControllerName])},hideModal:function(){app.mCtx&&app.mCtx.hide()},init:function(callBack){$(document).ready(function(){app.cordova.initializeCordova(function(){app.config.mobileRun?app.cordova.deviceReadyCallBack=function(){app.database.createDB(callBack)}:(app.events.onDeviceReady(),app.database.createDB(callBack))})})},changeLanguage:function(langCode){app.config.lang=langCode,console.log(app.config.lang),$.each(app.controller,function(controllerName,controllerObj){if("register"!==controllerName){var templateHtml=app.controller[controllerName].plainTemplate;templateHtml=app.message.replace(templateHtml),app.controller[controllerName].template=templateHtml}}),app.system.render(app.controller[app.ctx.fullName],app.ctx.data)},exit:function(){app.config.mobileRun?navigator.app.exitApp():(console.warn("EXIT APP"),app.system.hideModal())},mainRender:function(callBack){void 0!==app.events.onReady&&(console.log("EVENT READY"),app.events.onReady()),app.system.render(app.controller[app.config.mainController],null,callBack)}},app.component={total:0,componentsReady:0,register:function(name,obj){app.component.total++,obj.type="COMPONENT",obj.name=name.substring(0,1).toLowerCase()+name.substring(1,name.length),obj.fullName=name,obj.ready=!1,obj.data={},obj.clean=function(){app.component[name].data={}},app.component[name]=obj;var templateName=app.config.viewsPath+"/component/"+obj.name+"/"+obj.name+".view.html",templateHtml=templates[templateName],selectorsObj=app.system.createSelectors(templateHtml);app.component[name].selector=selectorsObj.selectors,templateHtml=selectorsObj.html,app.component[name].template=templateHtml,app.component[name].ready=!0,app.component.componentsReady++}},app.config={mobileRun:!1,debug:!0,mockApi:!1,mainController:"Home",viewsPath:"view",lang:"en",dbMode:"create-drop",dbTestMode:!0,dbCreateDropFromScript:!0,dbCreateScript:"sql/create.sql",dbDropScript:"sql/drop.sql",dbTestScript:"sqltest.sql",dbProductionScript:"sqlproduction.sql",dbName:"localdb",extend:function(configObj){for(var prop in configObj)app.config[prop]=configObj[prop]}},app.controller={register:function(name,obj){void 0!=obj.components&&null!=obj.components||(obj.components=[]),void 0!=obj.view&&null!=obj.view||(obj.view="main"),obj.name=name.substring(0,1).toLowerCase()+name.substring(1,name.length),obj.fullName=name,obj.render=function(data){$('[view="'+app.ctx.view+'"]').html(obj.template),obj.init(data)},obj.componentsReady=0,void 0==obj.data&&(obj.data={}),obj.ready=!1,app.controller[name]=obj;var templateName=app.config.viewsPath+"/controller/"+obj.name+"/"+obj.name+".view.html",templateHtml=templates[templateName],selectorsObj=app.system.createSelectors(templateHtml);app.controller[name].selector=selectorsObj.selectors,templateHtml=selectorsObj.html,app.controller[name].components instanceof Array?$.each(app.controller[name].components,function(i,componentName){var _component=app.component[componentName];templateHtml=templateHtml.split('<component name="'+_component.name+'"></component>').join(_component.template)}):$.each(app.controller[name].components,function(componentName,componentParams){var _component=app.component[componentName];templateHtml=templateHtml.split('<component name="'+_component.name+'"></component>').join(_component.template)}),app.controller[name].plainTemplate=templateHtml,templateHtml=app.message.replace(templateHtml),app.controller[name].template=templateHtml,app.controller[name].ready=!0}},$acr=app.controller.register,app.cordova={deviceReadyCallBack:null,initializeCordova:function(callBack){app.cordova.bindDOMEvents(),callBack()},bindDOMEvents:function(){document.addEventListener("deviceready",app.cordova.onDeviceReady,!1),document.addEventListener("backbutton",app.cordova.onBack,!1),void 0!==app.events.domEvents&&app.events.domEvents()},checkNetwork:function(){app.plugins.wrapper.network.connection(function(){app.cordova.onOnline()},function(){app.cordova.onOffline()})},onBack:function(e){e&&e.preventDefault(),null!==app.mCtx&&void 0!==app.mCtx.onBack?app.mCtx.onBack():null!==app.mCtx&&void 0==app.mCtx.onBack?app.system.hideModal():null!==app.ctx&&void 0!==app.ctx.onBack?(app.system.hideModal(),app.ctx.onBack()):void 0!==app.events.onBack&&app.events.onBack()},onDeviceReady:function(){void 0!==app.cordova.deviceReadyCallBack&&null!==app.cordova.deviceReadyCallBack&&app.cordova.deviceReadyCallBack()},onOnline:function(){app.online=!0,void 0!==app.events.onOnline&&app.events.onOnline()},onOffline:function(){app.online=!1,void 0!==app.events.onOffline&&app.events.onOffline()}},app.crud={replaceBooleanToString:function(sql){return sql=sql.split("'true'").join("'bool_true'"),sql=sql.split("'false'").join("'bool_false'"),sql=sql.split(" true").join("'bool_true'"),sql=sql.split(" false").join("'bool_false'")},execute:function(sql,successCallback,errorCallback){"string"!=typeof sql&&(sql=sql()),sql=this.replaceBooleanToString(sql),console.log(sql);var array=[],lastId=null;app.DB_INSTANCE.transaction(function(tx){tx.executeSql(sql,[],function(tx,results){var i,len=results.rows.length;for(i=0;len>i;i++){var item=results.rows.item(i);array.push(item)}sql.toLowerCase().indexOf("insert")>-1&&(lastId=results.insertId)},null)},function(err){void 0!==errorCallback&&errorCallback(),console.error(err)},function(){void 0!==successCallback&&successCallback(-1!=sql.toLowerCase().indexOf("insert")?lastId:array)})},builder:{findById:function(tableName,id){return"select * from "+tableName+" where id = "+id},deleteById:function(tableName,id){return"delete from "+tableName+" where id = "+id},drop:function(tableName){return"DROP TABLE IF EXISTS "+tableName},count:function(tableName){return"select count(*) as count from "+tableName},create:function(tableName,columns){for(var sql="CREATE TABLE IF NOT EXISTS "+tableName+" (id INTEGER PRIMARY KEY",i=0;i<columns.length;i++)sql+=", "+columns[i];return sql+=")"},findAll:function(tableName){return"SELECT * FROM "+tableName},select:function(tableName,values,columns){var sql="";sql="select * from "+tableName+" where ";for(var i=0;i<values.length;i++)sql+="string"==typeof values[i]||"boolean"==typeof values[i]?" "+columns[i]+"='"+values[i]+"' and ":" "+columns[i]+"="+values[i]+" and ";return sql=sql.substr(0,sql.length-4)},insert:function(tableName,values,columns){var sql="";if(void 0!==columns){sql="INSERT INTO "+tableName+" (";for(var i=0;i<columns.length;i++)sql+=columns[i]+",";sql=sql.substr(0,sql.length-1),sql+=") VALUES ("}else sql="INSERT INTO "+tableName+" VALUES (";for(var i=0;i<values.length;i++)sql+="string"==typeof values[i]||"boolean"==typeof values[i]?" '"+values[i]+"',":" "+values[i]+",";return sql=sql.substr(0,sql.length-1),sql+=")"},update:function(tableName,id,values,columns){var sql="";sql="UPDATE "+tableName+" SET ";for(var i=0;i<values.length;i++)sql+="string"==typeof values[i]||"boolean"==typeof values[i]?" "+columns[i]+"= '"+values[i]+"',":" "+columns[i]+"= "+values[i]+",";return sql=sql.substr(0,sql.length-1),sql+=" where id = "+id}}},app.dbTablesCount=0;var DB_INSTANCE=null;app.database={dbName:"",dbVersion:"1.0",dbSize:2097152,createDB:function(callBack){app.database.dbName=app.config.dbName,"none"==app.config.dbMode?(app.DB_INSTANCE=null,app.system.mainRender(callBack)):(app.config.mobileRun?app.DB_INSTANCE=window.sqlitePlugin.openDatabase({name:app.database.dbName,location:"default"}):app.DB_INSTANCE=openDatabase(app.database.dbName,app.database.dbVersion,app.database.dbName+"_manager",app.database.dbSize),"create-drop"==app.config.dbMode?app.database.dbDrop(function(){app.database.dbCreate(function(){console.log("DB created"),app.database.dbLoadData(function(){console.log("DB loaded"),app.system.mainRender(callBack)})})}):"create"==app.config.dbMode&&(console.log("create db 222"),app.database.dbCreate(function(){console.log("created db"),app.database.dbLoadData(function(){app.system.mainRender(callBack)})})))},dbLoadData:function(callBack){var finished=!1;app.config.dbTestMode?(console.log("xxx"),$.get(app.config.dbTestScript,function(data){if(0==data.trim().length)console.log("callback 2"),finished=!0,callBack();else{for(var queries=[],splitted=data.split(";"),i=0;i<splitted.length;i++)splitted[i].trim().length>0&&queries.push(splitted[i].trim());for(var i=0;i<queries.length;i++)app.crud.execute(queries[i],function(data){app.dbTablesCount++,app.dbTablesCount>=queries.length&&(app.dbTablesCount=0,finished||(console.log("callback 1"),finished=!0,callBack()))})}})):$.get(app.config.dbProductionScript,function(data){if(0==data.trim().length)console.log("callback 3"),finished=!0,callBack();else{for(var queries=[],splitted=data.split(";"),i=0;i<splitted.length;i++)splitted[i].trim().length>0&&queries.push(splitted[i].trim());for(var i=0;i<queries.length;i++)app.crud.execute(queries[i],function(data){app.dbTablesCount++,app.dbTablesCount>=queries.length&&(app.dbTablesCount=0,finished||(console.log("callback 4"),finished=!0,callBack()))})}})},dbCreate:function(callBack){if(app.config.dbCreateDropFromScript)$.get(app.config.dbCreateScript,function(data){if(0==data.trim().length)callBack();else{for(var queries=[],splitted=data.split(";"),i=0;i<splitted.length;i++)splitted[i].trim().length>0&&queries.push(splitted[i].trim());for(var i=0;i<queries.length;i++)app.crud.execute(queries[i],function(data){app.dbTablesCount++,app.dbTablesCount>=queries.length&&(app.dbTablesCount=0,callBack())})}});else{console.log("from model");for(var i=0;i<app.model.createScripts.length;i++)console.log(app.model.createScripts),app.crud.execute(app.model.createScripts[i],function(data){app.dbTablesCount++,app.dbTablesCount==app.model.createScripts.length&&(app.dbTablesCount=0,callBack())})}},dbDrop:function(callBack){if(app.config.dbCreateDropFromScript)$.get(app.config.dbDropScript,function(data){if(0==data.trim().length)callBack();else{for(var queries=[],splitted=data.split(";"),i=0;i<splitted.length;i++)splitted[i].trim().length>0&&queries.push(splitted[i].trim());for(var i=0;i<queries.length;i++)app.crud.execute(queries[i],function(data){app.dbTablesCount++,app.dbTablesCount>=queries.length&&(app.dbTablesCount=0,callBack())})}});else for(var i=0;i<app.model.dropScripts.length;i++)app.crud.execute(app.model.dropScripts[i],function(data){app.dbTablesCount++,app.dbTablesCount==app.model.dropScripts.length&&(app.dbTablesCount=0,callBack())})}},app.enumerator={register:function(name,list){app.enumerator[name]=list}},app.events={domEvents:function(){},onOnline:function(){},onOffline:function(){},onBack:function(){},onDeviceReady:function(){},onReady:function(){},extend:function(eventName,eventCallback){"render"==eventName&&(eventName="onRender"),"offline"==eventName&&(eventName="onOffline"),"online"==eventName&&(eventName="onOnline"),"dom"==eventName&&(eventName="domEvents"),"back"==eventName&&(eventName="onBack"),"ready"==eventName&&(eventName="onReady"),app.events[eventName]=eventCallback}},app.global={define:function(name,value){app.global[name]={get:function(){return window[name]},set:function(val){window[name]=val}},window[name]=value},defineMap:function(hashMap){$.each(hashMap,function(i,_global){app.global.define(_global.name,_global.initial)})}},app.message={messages:null,define:function(object){app.message.messages=object},get:function(_message){for(prop in app.message.messages)if(prop.toString()==_message)for(prop2 in app.message.messages[prop])if(prop2.toString()==app.config.lang)return app.message.messages[prop][prop2]},replace:function(html){for(prop in app.message.messages)html=html.split("msg("+prop.toString()+")").join(app.message.messages[prop][app.config.lang]);return html}},app.modal={register:function(name,obj){obj.name=name.substring(0,1).toLowerCase()+name.substring(1,name.length),obj.fullName=name,obj.data={},obj.ready=!1;var templateName=app.config.viewsPath+"/modal/"+obj.name+"/"+obj.name+".view.html",templateHtml=templates[templateName],tempTemplateId="#temp-template-"+app.util.System.hash();$("body").append('<div id="'+tempTemplateId.replace("#","")+'"></div>'),$(tempTemplateId).html(templateHtml);var modalSelector=$("[mainmodal]"),newModalId="modal-"+app.util.System.hash();modalSelector.attr("modalselector",newModalId),obj.id=newModalId,obj.selfSelector=function(){return $('[modalselector="'+newModalId+'"]')},obj.show=function(){$("body").removeClass("modal-open");var backgroundModalSelector=$(".modal-backdrop");backgroundModalSelector&&backgroundModalSelector.length>1&&$(backgroundModalSelector[0]).fadeOut(200,function(){$(this).remove()}),obj.selfSelector().modal("show"),obj.selfSelector().on("hidden.bs.modal",function(){console.log("hide2"),app.mCtx.onHide&&app.mCtx.onHide(),obj.forceHide()})},obj.hide=function(callBack){obj.preventDismiss||(console.log("hide1"),obj.forceHide())},obj.render=function(data){$('[modal="'+obj.name+'"]').html(obj.template),obj.preventDismiss?obj.selfSelector().modal({backdrop:"static",keyboard:!1}):obj.selfSelector().modal(),obj.init(data),obj.show()},obj.forceHide=function(){console.log("force hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$('[modal="'+obj.name+'"]').html(""),app.mCtx=null},templateHtml=$(tempTemplateId).html(),$(tempTemplateId).remove();var selectorsObj=app.system.createSelectors(templateHtml);obj.selector=selectorsObj.selectors,templateHtml=selectorsObj.html,templateHtml=app.message.replace(templateHtml),obj.template=templateHtml,obj.ready=!0,app.modal[name]=obj}},app.model={createScripts:[],dropScripts:[],define:function(name,fieldList){var columnsWithId=$.app.copyArray(fieldList).unshift("id"),nameUpperCase=name.toUpperCase(),dropTableSql=app.crud.builder.drop(nameUpperCase),createTableSql=app.crud.builder.create(nameUpperCase,fieldList),findAllSql=app.crud.builder.findAll(nameUpperCase);app.model.createScripts.push(createTableSql),app.model.dropScripts.push(dropTableSql);var obj={table:nameUpperCase,name:nameUpperCase,columns:fieldList,columnsAll:columnsWithId,dropSQL:dropTableSql,createSQL:createTableSql,findAllSQL:findAllSql,"new":function(objList){for(var modelObj={},i=0;i<this.columns;i++)void 0!==objList[this.columns[i]]?modelObj[this.columns[i]]=objList[this.columns[i]]:modelObj[this.columns[i]]=null;return modelObj}};app.model[name]=obj}},app.plugins={wrapper:{},wrapList:function(wrapList){app.plugins.wrapper=$.extend(!0,app.plugins.wrapper,wrapList)},wrap:function(pluginName,wrapper){app.plugins.wrapper[pluginName]=wrapper}},app.query={defineList:function(list){$.each(list,function(i,queryObj){app.query.define(queryObj.name,queryObj.sql,queryObj.group)})},define:function(name,sql,group){var obj={sql:sql,bind:function(valueListOrObj){var sql=this.sql;if(valueListOrObj instanceof Array)for(var i=0;i<valueListOrObj.length;i++)sql="string"==typeof valueListOrObj[i]?sql.replace("?","'"+valueListOrObj[i]+"'"):sql.replace("?",valueListOrObj[i]);else for(var fieldName in valueListOrObj){var fieldValue=valueListOrObj[fieldName];sql="string"==typeof fieldValue?sql.replace(":"+fieldName,"'"+valueListOrObj[i]+"'"):sql.replace(":"+fieldName,fieldValue)}return sql},execute:function(valueList,successCallback,errorCallback){var sqlToExecute=this.sql;void 0!==valueList&&(sqlToExecute=this.bind(valueList)),app.crud.execute(sqlToExecute,successCallback,errorCallback)}};void 0==group?app.query[name]=obj:(void 0==app.query[group]&&(app.query[group]={}),app.query[group][name]=obj)}},$aql=app.query.defineList,$aqd=app.query.define,app.rest={spinnerShow:function(){},spinnerHide:function(){},get:function(url,successCallback,errorCallback,urlParams,headers){app.rest.getDelete(url,"GET",successCallback,errorCallback,urlParams,headers)},"delete":function(url,successCallback,errorCallback,urlParams,headers){app.rest.getDelete(url,"DELETE",successCallback,errorCallback,urlParams,headers)},update:function(url,request,successCallback,errorCallback,urlParams,headers){app.rest.postPut(url,"PUT",request,successCallback,errorCallback,urlParams,headers)},post:function(url,request,successCallback,errorCallback,urlParams,headers){app.rest.postPut(url,"POST",request,successCallback,errorCallback,urlParams,headers)},isMock:function(url,method,request,successCallback,callBackIsnt){if(app.config.mockApi){var result=app.mock.execByUrl(url,method,request);successCallback(result)}else callBackIsnt()},getDelete:function(url,method,successCallback,errorCallback,urlParams,headers){app.rest.isMock(url,method,urlParams,successCallback,function(){var preparedUrl=null;preparedUrl=void 0!==urlParams&&null!==urlParams?app.util.System.prepareUrl(url,urlParams):url,$.ajax({url:preparedUrl,type:method,beforeSend:function(){app.rest.spinnerShow(url)},complete:function(){app.rest.spinnerHide(url)},headers:headers,contentType:"application/json; charset=utf-8",dataType:"json",success:function(data,textStatus,jqXHR){successCallback(data)},error:function(jqXHR,textStatus,errorThrown){void 0!==errorCallback&&(console.log(jqXHR),errorCallback(jqXHR.responseJSON,jqXHR.status,jqXHR))}})})},postPut:function(url,method,request,successCallback,errorCallback,urlParams,headers){app.rest.isMock(url,method,request,successCallback,function(){console.log(headers);var preparedUrl=null;preparedUrl=void 0!==urlParams&&null!==urlParams?app.util.System.prepareUrl(url,urlParams):url;var jsonData=JSON.stringify(request);$.ajax({url:preparedUrl,type:method,beforeSend:function(){app.rest.spinnerShow(url)},complete:function(){app.rest.spinnerHide(url)},headers:headers,contentType:"application/json; charset=utf-8",dataType:"json",data:jsonData,success:function(data,textStatus,jqXHR){successCallback(data)},error:function(jqXHR,textStatus,errorThrown){void 0!==errorCallback&&(console.log(jqXHR),errorCallback(jqXHR.responseJSON,jqXHR.status,jqXHR))}})})}},app.service={register:function(name,obj){app.service[name]=obj}},app.util={register:function(name,obj){app.util[name]=obj},System:{isFunction:function(functionToCheck){var getType={};return functionToCheck&&"[object Function]"===getType.toString.call(functionToCheck)},parseJSON:function(s){s=s.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f"),s=s.replace(/[\u0000-\u0019]+/g,"");var o=JSON.parse(s);return o},isNull:function(obj){return void 0==obj||null==obj},prepareUrl:function(url,params){for(var prop in params)url=url.replace("{"+prop+"}",params[prop]);return url},findStringBetween:function(str,first,last){var r=new RegExp(first+"(.*?)"+last,"gm"),arr=str.match(r);if(null==arr||0==arr.length)return[];for(var arr2=[],i=0;i<arr.length;i++)arr2.push(arr[i].replace(first,"").replace(last,""));return arr2},hash:function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;5>i;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}}},app.mock={api:{},execByUrl:function(url,method,request){for(prop in app.mock.api)if(app.mock.api[prop].url==url)return app.mock.api[prop].exec(request)},execByName:function(name,method,request){for(prop in app.mock.api)if(prop==name&&app.mock.api[prop].method==method.toLowerCase())return app.mock.api[prop].exec(request)},registerList:function(mockList){$.each(mockList,function(i,mockObj){app.mock.register(mockObj.name,mockObj.url,mockObj.method,mockObj.returning)})},register:function(name,url,method,returning){var urlVal=null;urlVal="string"==typeof url?url:url(),app.mock.api[name]={url:urlVal,method:method,exec:returning}}},app.renderer={define:function(name,template,renderPerContext){var htmlTemplate=null;void 0!=renderPerContext&&null!=renderPerContext||(renderPerContext=!1),htmlTemplate=0==renderPerContext?template():template,htmlTemplate=app.message.replace(htmlTemplate);var obj={renderPerContext:renderPerContext,template:htmlTemplate,dataIds:null,bindings:null,listSelector:null,data:null,update:function(eCtx,compareField){var _this=this;$.each(this.dataIds,function(i,listObj){if(listObj.context[compareField]==eCtx[compareField]){_this.dataIds[i].context=eCtx,_this.data[i]=eCtx;var template="";template=_this.renderPerContext?_this.template(i,eCtx):_this.template();var newListElementHtml=_this.renderElement(listObj.dataId,listObj.listElementId,template,listObj.context);for(var prop in _this.bindings)newListElementHtml=newListElementHtml.split("event("+prop+")").join('event="'+prop+'"');$('*[liId="'+listObj.listElementId+'"]').replaceWith(newListElementHtml)}})},renderElement:function(dataId,listElementId,html,element){html=html.replace(">",' liId="'+listElementId+'" >'),html=html.split("event(").join(' dataId="'+dataId+'" event(');for(var prop in element)html=html.split("text("+prop+")").join(element[prop]);return html},render:function(listSelector,data,bindings){var _this=this,elementsHtml=[],dataIds=[],templatehtml=this.template,html=templatehtml,renderPerContext=this.renderPerContext;$.each(data,function(i,element){renderPerContext&&(html=templatehtml(i,element));var listElementId="li-"+app.util.System.hash()+"-"+app.util.System.hash()+"-"+app.util.System.hash(),dataId="element-"+app.util.System.hash()+"-"+app.util.System.hash()+"-"+app.util.System.hash();html=_this.renderElement(dataId,listElementId,html,element),dataIds.push({listElementId:listElementId,dataId:dataId,context:element}),elementsHtml.push(html),html=templatehtml}),html="";for(var i=0;i<elementsHtml.length;i++)html+=elementsHtml[i];for(var prop in bindings)html=html.split("event("+prop+")").join('event="'+prop+'"');listSelector.html(html),this.bindings=bindings,this.listSelector=listSelector,this.data=data,this.bind(listSelector,dataIds,bindings,data)},bind:function(listSelector,dataIds,bindings,dataList){var dataIdsLocal=dataIds;listSelector.unbind(),$.each(bindings,function(functionName,functionCallback){listSelector.on("click",'[event="'+functionName+'"]',function(e){var arrtributeDataId=$(e.currentTarget).attr("dataId");$.each(dataIdsLocal,function(i,dataId){if(dataId.dataId==arrtributeDataId){e.eCtx=dataId.context;var selector=$('*[dataId="'+dataId.dataId+'"]');selector.dataId=dataId.dataId,e.eCtxSelector=function(){return selector}}}),e.eCtxList=dataList,functionCallback(e)})}),this.dataIds=dataIdsLocal}};app.renderer[name]=obj}};